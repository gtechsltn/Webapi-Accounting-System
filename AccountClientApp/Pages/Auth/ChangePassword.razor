@page "/auth/change-password"
@inject HttpClient Http

<div class="container mt-4">
    <h3 class="text-center">Change Password</h3>
    <form>
        <div class="mb-3">
            <label for="oldPassword" class="form-label">Old Password:</label>
            <input type="password" id="oldPassword" class="form-control" @bind="oldPassword" />
        </div>
        <div class="mb-3">
            <label for="newPassword" class="form-label">New Password:</label>
            <input type="password" id="newPassword" class="form-control" @bind="newPassword" />
        </div>
        <div class="mb-3">
            <label for="confirmNewPassword" class="form-label">Confirm New Password:</label>
            <input type="password" id="confirmNewPassword" class="form-control" @bind="confirmNewPassword" />
        </div>
        <button type="button" class="btn btn-primary w-100" @onclick="UpdatePassword">Change Password</button>
    </form>
    <p class="mt-3 text-center">@message</p>
</div>

<p>@message</p>

@code {
    private string oldPassword, newPassword, confirmNewPassword;
    private string message = "";

    private async Task UpdatePassword()
    {
        if (newPassword != confirmNewPassword)
        {
            message = "New passwords do not match.";
            return;
        }

        var payload = new { OldPassword = oldPassword, NewPassword = newPassword };
        var response = await Http.PostAsJsonAsync("api/auth/change-password", payload);

        message = response.IsSuccessStatusCode ? "Password changed successfully!" : "Password change failed.";
    }
}